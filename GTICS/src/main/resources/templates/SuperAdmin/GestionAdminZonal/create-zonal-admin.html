<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta content="Codescandy" name="author">
    <title>Crear nuevo administrador zonal</title>
    <!-- Favicon icon-->
    <link rel="shortcut icon" type="image/x-icon" th:href="@{/images/favicon/favicon.ico}">


    <!-- Libs CSS -->
    <link th:href="@{/libs/bootstrap-icons/font/bootstrap-icons.min.css}" rel="stylesheet">
    <link th:href="@{/libs/feather-webfont/dist/feather-icons.css}" rel="stylesheet">
    <link th:href="@{/libs/simplebar/dist/simplebar.min.css}" rel="stylesheet">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <!-- Theme CSS -->
    <link rel="stylesheet" th:href="@{/css/theme.min.css}">
    <style>

        .logoImagen{
            height: 80px;
            width: 250px;
        }
        .logoImagenCelulares{
            height: 80px;
            width: 220px;
        }
    </style>

</head>

<body>
<!-- main -->
<div>
    <!-- navbar -->
    <div th:insert="~{fragments/navbarSuperior.html :: navbarSuperior}"></div>


    <div class="main-wrapper">
        <!-- navbar -->
        <!-- navbar vertical (para pc)-->
        <div th:insert="~{fragments/navbarSuperAdmin.html :: navbarVerticalPc('listaAdminZonal')}"></div>

        <!-- navbar vertical (para celular)-->
        <div th:insert="~{fragments/navbarSuperAdmin.html :: navbarVerticalCelulares('listaAdminZonal')}"></div>
        <!-- COONTENIDO DE LA PAGINA -->
        <main class="main-content-wrapper">
            <div class="container">
                <div class="row mb-8">
                    <div class="col-md-12">
                        <div>
                            <h2>Crear administrador zonal</h2>
                            <!-- breacrumb -->
                            <nav aria-label="breadcrumb">
                                <ol class="breadcrumb mb-0">
                                    <li class="breadcrumb-item"><a th:href="@{
                                    dashboard}" class="text-inherit">Dashboard</a></li>
                                    <li class="breadcrumb-item active" aria-current="page">Crear</li>
                                </ol>
                            </nav>
                        </div>
                    </div>
                </div>
                <div class="row" style="min-height: 100vh;">
                    <div class="col-12">
                        <div class="card shadow border-0">

                            <div class="card-body d-flex flex-column gap-8 p-7">
                                <form id="adminZonalForm" enctype="multipart/form-data" th:action="@{/SuperAdmin/AdminZonal/guardar}" method="post" class="needs-validation" novalidate>
                                    <div class="d-flex flex-column flex-md-row align-items-center mb-4 file-input-wrapper gap-2">
                                        <div>
                                            <img id="imagePreviewForm" class="image avatar avatar-lg rounded-3" th:src="@{/images/docs/placeholder-img.jpg}" alt="Image" />
                                        </div>
                                        <label for="fileInput" class="form-label">Subir foto:</label>

                                        <div class="file-upload btn btn-light ms-md-4">
                                            <input type="file" class="file-input opacity-0" id="fileInput" name="zonalAdminPhoto" accept="image/png, image/jpeg, image/gif"  />
                                            <span>Subir foto</span>
                                        </div>

                                        <span class="ms-2">JPG, GIF or PNG. 1MB Max.</span>
                                    </div>
                                    <div class="d-flex flex-column gap-4">
                                        <h3 class="mb-0 h5">Información del administrador zonal</h3>
                                        <div th:if="${error}" class="alert alert-danger">
                                            <span th:text="${error}"></span>
                                        </div>
                                            <input type="hidden" name="idusuario" th:value="${usuario.id != null ? usuario.id : ''}" />
                                            <div class="row g-3">

                                                <!-- Nombres -->
                                                <div class="col-lg-6 col-12">
                                                    <label for="creatCustomerName" class="form-label">
                                                        Nombres: <span style="visibility: hidden;">*</span>
                                                    </label>
                                                    <input type="text" class="form-control" id="creatCustomerName" name="nombre" placeholder="Nombre del admin zonal" required />
                                                    <div class="invalid-feedback">Por favor ingrese los nombres del admin zonal</div>
                                                </div>

                                                <!-- Apellidos -->
                                                <div class="col-lg-6 col-12">
                                                    <label for="creatFinalUserLastNameP" class="form-label">
                                                        Apellido Paterno: <span style="visibility: hidden;">*</span>
                                                    </label>
                                                    <input type="text" class="form-control" id="creatFinalUserLastNameP" name="apellidoPaterno" placeholder="Apellido paterno del admin zonal" required />
                                                    <div class="invalid-feedback">Por favor ingrese el apellido paterno del admin zonal</div>
                                                </div>
                                                <div class="col-lg-6 col-12">
                                                    <label for="creatFinalUserLastNameM" class="form-label">
                                                        Apellido Materno: <span style="visibility: hidden;">*</span>
                                                    </label>
                                                    <input type="text" class="form-control" id="creatFinalUserLastNameM" name="apellidoMaterno" placeholder="Apellido materno del admin zonal" required />
                                                    <div class="invalid-feedback">Por favor ingrese el apellido materno del admin zonal</div>
                                                </div>
                                                <!-- DNI -->
                                                <div class="col-lg-6 col-12">
                                                    <label for="DNIFinalUser" class="form-label">
                                                        DNI: <span style="visibility: hidden;">*</span>
                                                    </label>
                                                    <input type="text" class="form-control" id="DNIFinalUser" name="dni" minlength="8" maxlength="8" pattern="\d{8}" placeholder="Ejemplo: 12345678" required />
                                                    <div class="invalid-feedback" id="dni-feedback">Por favor ingrese un DNI válido con 8 dígitos</div>
                                                </div>

                                                <!-- Número telefónico -->
                                                <div class="col-lg-6 col-12">
                                                    <label for="phoneAdminZonal" class="form-label">
                                                        Número telefónico: <span style="visibility: hidden;">*</span>
                                                    </label>
                                                    <input type="text" class="form-control" id="phoneAdminZonal" name="telefono" placeholder="Teléfono" minlength="9" maxlength="9" pattern="\d{9}" required />
                                                    <div class="invalid-feedback" id="phone-feedback">El teléfono debe contener exactamente 9 dígitos</div>
                                                </div>

                                                <!-- Email -->
                                                <div class="col-lg-6 col-12">
                                                    <label for="creatFinalUserEmail" class="form-label">
                                                        Email: <span style="visibility: hidden;">*</span>
                                                    </label>
                                                    <input type="email" class="form-control" id="creatFinalUserEmail" name="email" placeholder="Correo Electrónico" required />
                                                    <div class="invalid-feedback">Por favor ingrese el correo electrónico del admin zonal</div>
                                                </div>

                                                <!-- Dirección -->
                                                <div class="col-lg-6 col-12">
                                                    <label for="creatFinalUserDirection" class="form-label">Dirección</label>
                                                    <input type="text" class="form-control" id="creatFinalUserDirection" name="direccion" placeholder="Dirección" required />
                                                    <div class="invalid-feedback">Por favor ingrese la dirección del admin zonal</div>
                                                </div>

                                                <!-- Selección de zona -->
                                                <div class="col-lg-6 col-12">
                                                    <label for="selectZone" class="form-label">Zona</label>
                                                    <select class="form-select" name="zonaId" id="selectZone" required>
                                                        <option value="" selected disabled>--Seleccione una zona--</option>
                                                        <option th:each="zona : ${zonas}" th:text="${zona.getNombreZona()}" th:value="${zona.id}"></option>
                                                    </select>
                                                    <div class="invalid-feedback">Por favor seleccione una zona</div>
                                                </div>

                                                <!-- Fecha de nacimiento -->
                                                <div class="col-lg-6 col-12">
                                                    <label class="form-label" for="creatFinalUserDate">Fecha de nacimiento</label>
                                                    <input type="date" class="form-control" id="creatFinalUserDate" name="azFechanacimiento" placeholder="Fecha de nacimiento" required />
                                                    <div class="invalid-feedback" id="fecha-feedback">Por favor ingrese una fecha válida de nacimiento</div>
                                                </div>

                                                <!-- Contraseña temporal -->
                                                <div class="col-6">
                                                    <label class="form-label" for="passwordAdminZonal">Contraseña temporal</label>
                                                    <div class="input-group">
                                                        <input type="text" class="form-control" id="passwordAdminZonal" name="contrasena" required />
                                                        <button class="btn btn-outline-secondary" type="button" id="generatePassword">Generar</button>
                                                    </div>
                                                </div>

                                                <!-- Botones de acción -->
                                                <div class="col-12 mt-3">
                                                    <div class="d-flex flex-column flex-md-row gap-2">
                                                        <button class="btn btn-primary" type="button" onclick="confirmarRegistro()">Crear</button>
                                                        <a th:href="@{/SuperAdmin/listaAdminZonal}" class="btn btn-secondary">Cancelar</a>
                                                    </div>
                                                </div>
                                            </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
</div>

<!-- Libs JS -->
<!-- <script src="../assets/libs/jquery/dist/jquery.min.js"></script> -->
<script th:src="@{/libs/bootstrap/dist/js/bootstrap.bundle.min.js}"></script>
<script th:src="@{/libs/simplebar/dist/simplebar.min.js}"></script>

<!-- Theme JS -->
<script th:src="@{/js/theme.min.js}"></script>

<script th:src="@{/libs/apexcharts/dist/apexcharts.min.js}"></script>
<script th:src="@{/js/vendors/chart.js}"></script>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const fileInput = document.getElementById('fileInput');
        const imagePreview = document.getElementById('imagePreviewForm'); // Asegúrate de seleccionar solo la imagen del formulario

        fileInput.addEventListener('change', function () {
            const file = fileInput.files[0];
            if (file && file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    imagePreview.src = e.target.result;  // Cambia solo la imagen del formulario
                };
                reader.readAsDataURL(file);
            } else {
                imagePreview.src = '/images/docs/placeholder-img.jpg';  // Vuelve a la imagen por defecto si no es válida
            }
        });
    });
    </script>
    <script>
            document.addEventListener('DOMContentLoaded', function () {
            const form = document.getElementById('adminZonalForm');
            const dateInput = document.getElementById('creatFinalUserDate');
            const phoneInput = document.getElementById('phoneAdminZonal');
            const dniInput = document.getElementById('DNIFinalUser');

            const phoneFeedback = document.getElementById('phone-feedback');
            const dniFeedback = document.getElementById('dni-feedback');

            // Validar fecha de nacimiento (no puede ser futura)
            dateInput.addEventListener('blur', function () {
            const currentDate = new Date().toISOString().split('T')[0]; // Fecha actual en formato YYYY-MM-DD
            if (dateInput.value > currentDate) {
            dateInput.setCustomValidity("La fecha de nacimiento no puede ser futura.");
            dateInput.classList.add('is-invalid');
        } else {
            dateInput.setCustomValidity(""); // Restablecer si la fecha es válida
            dateInput.classList.remove('is-invalid');
            dateInput.classList.add('is-valid');
        }
        });

            // Validar teléfono al salir del campo
            phoneInput.addEventListener('blur', function () {
            if (phoneInput.validity.valueMissing) {
            phoneFeedback.textContent = 'Por favor ingrese el número de teléfono';
            phoneInput.classList.add('is-invalid');
        } else if (phoneInput.validity.patternMismatch) {
            phoneFeedback.textContent = 'El número de teléfono debe contener exactamente 9 dígitos';
            phoneInput.classList.add('is-invalid');
        } else {
            phoneInput.classList.remove('is-invalid');
            phoneInput.classList.add('is-valid'); // Marca como válido
        }
        });

            // Validar DNI al salir del campo
            dniInput.addEventListener('blur', function () {
            if (dniInput.validity.valueMissing) {
            dniFeedback.textContent = 'Por favor ingrese el DNI del Admin Zonal';
            dniInput.classList.add('is-invalid');
        } else if (dniInput.validity.patternMismatch) {
            dniFeedback.textContent = 'El DNI debe contener exactamente 8 dígitos';
            dniInput.classList.add('is-invalid');
        } else {
            dniInput.classList.remove('is-invalid');
            dniInput.classList.add('is-valid'); // Marca como válido
        }
        });

            // Validar todo el formulario al enviarlo
            form.addEventListener('submit', function (event) {
            if (!form.checkValidity()) {
            event.preventDefault();
            event.stopPropagation();
        }
            form.classList.add('was-validated'); // Forzar mostrar validaciones
        });
        });

            // Función para mostrar el popup de confirmación con validación del formulario
            function confirmarRegistro() {
            Swal.fire({
                title: '¿Estás seguro?',
                text: "¿Deseas crear un nuevo administrador zonal?",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#28a745',
                cancelButtonColor: '#dc3545',
                confirmButtonText: 'Sí, crear',
                cancelButtonText: 'Cancelar'
            }).then((result) => {
                if (result.isConfirmed) {
                    const form = document.getElementById('adminZonalForm');
                    if (form.checkValidity()) {
                        form.submit();
                    } else {
                        form.classList.add('was-validated'); // Forzar la validación si es incorrecta
                    }
                }
            });
        }

            document.addEventListener("DOMContentLoaded", function() {
            flatpickr("#creatFinalUserDate", {
                dateFormat: "Y-m-d"  // Esto asegura que la fecha se envíe en formato yyyy-MM-dd
            });
        });

            document.addEventListener("DOMContentLoaded", function() {
            document.getElementById("generatePassword").addEventListener("click", generatePassword);
        });

            function generatePassword() {
            console.log("Botón de generar contraseña presionado");
            const length = 12;
            const charset = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*()";
            let password = "";

            for (let i = 0; i < length; i++) {
            const randomIndex = Math.floor(Math.random() * charset.length);
            password += charset[randomIndex];
        }

            document.getElementById("passwordAdminZonal").value = password;
        }
</script>

</body>
</html>






